<?php	/*error_reporting(E_ALL & E_STRICT);	ini_set('display_errors', '1');	ini_set('log_errors', '0');	ini_set('error_log', './');*/		function read($id, $name){		$filename = "..\\..\\data\\".$id."\\".$name.".dat";		$handle = fopen($filename, "rb");		$datas = array();				$FPDM = unpack('C*', fread($handle, 4));			//46 50 44 4D					- nagłówek (FPDM)		$timestamp = unpack('V', fread($handle, 4))[1];		//53 38 07 40					- timestamp		$filesize = unpack('V', fread($handle, 4))[1];		//00 00 00 00					- rozmiar pliku		$signalcount = unpack('v', fread($handle, 2))[1];	//00 01							- liczba sygnałów		$duration = unpack('V', fread($handle, 4))[1];		//00 00 00 00					- liczba sekund		$reservedF = unpack('C*', fread($handle, 8));		//00 00 00 00 00 00 00 00		- zarezerwowane				if($FPDM[1] != 70 || $FPDM[2] != 80 || $FPDM[3] != 68 || $FPDM[4] != 77)			$data['error']['FPDM'] = 1;								for($j = 0; $j < $signalcount; $j++){			//sygnał			$DATA = unpack('C*', fread($handle, 4));			//44 41 54 41					- nagłówek (DATA)			$signalid = unpack('v', fread($handle, 2))[1];		//00 00							- id			$frequency = unpack('v', fread($handle, 2))[1];		//00 00							- częstotliwość (Hz)			$probesize = unpack('v', fread($handle, 2))[1];		//00 00							- rozmiar próbki (bajt)			$probecount = unpack('V', fread($handle, 4))[1];	//00 00 00 00					- liczba próbek			$reservedS = unpack('V', fread($handle, 4))[1];		//00 00 00 00					- zarezerwowane					if($probesize == 2)				$flag = 'v';			elseif($probesize == 4)				$flag = 'V';			else				$flag = 'C*';						$signal = array();						//echo $probecount;						for($i = 0; $i < $probecount; $i++){				$signal[] = unpack($flag, fread($handle, $probesize))[1];//próbki			}					$STOP = unpack('C*', fread($handle, 4));			//53 54 4F 50					- nagłówek (STOP)						//flagi błęgów			if($DATA[1] != 68 || $DATA[2] != 65 || $DATA[3] != 84 || $DATA[4] != 65)				$data['error']['DATA'] = 1;			if($STOP[1] != 83 || $STOP[2] != 84 || $STOP[3] != 79 || $STOP[4] != 80)				$data['error']['STOP'] = 1;			if($probecount/$frequency != $duration)				$data['error']['length'] = 1;						$data['id'] = $signalid;			$data['start'] = $timestamp;			$data['period'] = 1000 * 60 / $frequency;			$data['signal'] = $signal;			$datas[] = $data;		}				$aa['result'] = $datas;		header('Content-Type: application/json');		echo json_encode($aa);		fclose($handle);	}		function listFiles($id){		$path = "..\\..\\data\\".$id;		$files = array();				if ($handle = opendir($path)) {			while (false !== ($entry = readdir($handle))) {				if ($entry != "." && $entry != "..")					$files[] = $entry;			}			closedir($handle);						$aa['list'] = $files;			header('Content-Type: application/json');			echo json_encode($aa);		}	}		function getFile($file){		$uploaddir = './';//<----This is all I changed		$uploadfile = $uploaddir . basename($_FILES[$file]['name']);		echo '<pre>';		if (move_uploaded_file($_FILES[$file]['tmp_name'], $uploadfile)) {			echo "File is valid, and was successfully uploaded.\n";		} else {			echo "Possible file upload attack!\n";		}		echo 'Here is some more debugging info:';		print_r($_FILES);				echo $_FILES[$file]['error'];		print "</pre>";	}		if($_POST){		if($_POST['function'])			$fun = $_POST['function'];		else			$fun = 'error';		if($_POST['name'])			$name = $_POST['name'];		else			$name = 'new_'.date("d-m-Y");		if($_POST['uid'])			$uid = $_POST['uid'];		else			$uid = -1;	}	else if($_GET){		if($_GET['function'])			$fun = $_GET['function'];		else			$fun = 'error';		if($_GET['name'])			$name = $_GET['name'];		else			$name = 'new_'.date("d-m-Y");		if($_GET['uid'])			$uid = $_GET['uid'];		else			$uid = -1;	}	else		$name = 'new_'.date("d-m-Y");			$id = "u".sprintf('%06d', $uid);		if($fun == 'readFile')		read($id,$name);	else if($fun == 'listFiles')		listFiles($id);	else if($fun == 'getFile')		getFile($name);?>